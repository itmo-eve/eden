# Number of tests
{{$tests := 37}}
# EDEN_TEST env. var. -- flavour of test set: "small", "medium"(default) and "large"
{{$workflow := EdenGetEnv "EDEN_TEST"}}
# EDEN_TEST_SETUP env. var. -- "y"(default) performs the EDEN setup steps
{{$setup := "y"}}
{{$setup_env := EdenGetEnv "EDEN_TEST_SETUP"}}
{{if $setup_env}}{{$setup = $setup_env}}{{end}}
# EDEN_TEST_STOP -- "y" stops EDEN after tests ("n" by default)
{{$stop := EdenGetEnv "EDEN_TEST_STOP"}}
# EDEN_TEST_USB_PT -- "y" enables USB Passthrough test (disabled by default).
{{$usb_pt := EdenGetEnv "EDEN_TEST_USB_PT"}}
# EDEN_TEST_AUDIO_PT -- "y" enables Audio Passthrough test (disabled by default).
{{$audio_pt := EdenGetEnv "EDEN_TEST_AUDIO_PT"}}
# EDEN_TEST_ETH_PT -- "y" enables Ethernet Passthrough test (disabled by default).
{{$eth_pt := EdenGetEnv "EDEN_TEST_ETH_PT"}}
# EDEN_TEST_REGISTRY env. var. -- "y"(default) performs the local EDEN registry test
{{$registry := EdenGetEnv "EDEN_TEST_REGISTRY"}}

{{$devmodel := EdenConfig "eve.devmodel"}}

{{if (ne $setup "n")}}
#./eden config add default
/bin/echo Eden setup (01/{{$tests}})
eden.escript.test -test.run TestEdenScripts/eden_setup
#source ~/.eden/activate.sh
{{end}}

# Making some settings for test configuration if we work with QEMU
{{if and (eq $usb_pt "y") (eq $devmodel "ZedVirtual-4G") }}
qemu+usb.sh
{{end}}
{{if and (eq $audio_pt "y") (eq $devmodel "ZedVirtual-4G") }}
qemu+audio.sh
{{end}}
{{if or (eq $devmodel "ZedVirtual-4G") (eq $devmodel "VBox") (eq $devmodel "parallels") }}
eden+ports.sh 2223:2223 2224:2224 5912:5902 5911:5901 8027:8027 8028:8028 8029:8029 8030:8030 8031:8031
{{end}}

{{if (ne $setup "n")}}
/bin/echo Eden start (02/{{$tests}})
eden.escript.test -test.run TestEdenScripts/eden_start
/bin/echo Eden onboard (03/{{$tests}})
eden.escript.test -test.run TestEdenScripts/eden_onboard
/bin/echo Eden template check (03.1/{{$tests}})
eden.escript.test -test.run TestEdenScripts/template_check
{{end}}

{{if (ne $setup "y")}}
# Just restart EVE if not using the SETUP steps
# Is it QEMU?
{{if or (eq $devmodel "ZedVirtual-4G") (eq $devmodel "VBox") (eq $devmodel "parallels") }}
/bin/echo EVE restart (04/{{$tests}})
eden.escript.test -test.run TestEdenScripts/eve_restart
{{end}}
{{end}}

/bin/echo Eden Log test (05/{{$tests}})
eden.escript.test -testdata ../lim/testdata/ -test.run TestEdenScripts/log_test
/bin/echo Eden SSH test (06/{{$tests}})
eden.escript.test -test.run TestEdenScripts/ssh
/bin/echo Eden Info test (07/{{$tests}})
eden.escript.test -testdata ../lim/testdata/ -test.run TestEdenScripts/info_test
/bin/echo Eden Metric test (08/{{$tests}})
eden.escript.test -testdata ../lim/testdata/ -test.run TestEdenScripts/metric_test

/bin/echo Escript args test (09/{{$tests}})
eden.escript.test -testdata ../escript/testdata/ -test.run TestEdenScripts/arg -args=test1=123,test2=456
/bin/echo Escript template test (10/{{$tests}})
eden.escript.test -testdata ../escript/testdata/ -test.run TestEdenScripts/template
/bin/echo Escript message test (11/{{$tests}})
eden.escript.test -testdata ../escript/testdata/ -test.run TestEdenScripts/message
/bin/echo Escript nested scripts test (12/{{$tests}})
eden.escript.test -testdata ../escript/testdata/ -test.run TestEdenScripts/nested_scripts
/bin/echo Escript time test (13/{{$tests}})
eden.escript.test -testdata ../escript/testdata/ -test.run TestEdenScripts/time
/bin/echo Escript source test (14/{{$tests}})
eden.escript.test -testdata ../escript/testdata/ -test.run TestEdenScripts/source
/bin/echo Escript fail scenario test (15/{{$tests}})
eden.escript.test -testdata ../escript/testdata/ -test.run TestEdenScripts/fail_scenario

/bin/echo Eden ZFS state and layout check (zfs.1/{{$tests}})
eden.escript.test -testdata ../zfs/testdata/ -test.run TestEdenScripts/state_and_layout_check

/bin/echo Eden basic network test (16/{{$tests}})
eden.escript.test -testdata ../network/testdata/ -test.run TestEdenScripts/network_test
/bin/echo Eden basic VLAN test (16.1/{{$tests}})
eden.escript.test -testdata ../network/testdata/ -test.run TestEdenScripts/switch_net_vlans
/bin/echo Eden basic VLAN test (16.2/{{$tests}})
eden.escript.test -testdata ../network/testdata/ -test.run TestEdenScripts/vlans_and_bonds
/bin/echo Eden basic volumes test (17.1/{{$tests}})
eden.escript.test -testdata ../volume/testdata/ -test.run TestEdenScripts/volumes_test
/bin/echo Eden sftp volumes test (17.2/{{$tests}})
eden.escript.test -testdata ../volume/testdata/ -test.run TestEdenScripts/volume_sftp
/bin/echo Eden test for local datastore volume (17.3/{{$tests}})
eden.escript.test -testdata ../volume/testdata/ -test.run TestEdenScripts/local_datastore

{{if (eq $stop "y")}}
/bin/echo Eden stop (37/{{$tests}})
eden.escript.test -test.run TestEdenScripts/eden_stop
{{end}}
